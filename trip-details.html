<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip Details - Travel Budget Tracker</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <header>
        <nav>
            <div class="logo">TravelBudget</div>
            <div class="nav-links">
                <a href="dashboard.html">Dashboard</a>
                <a href="trips.html">My Trips</a>
                <a href="#" onclick="userManager.logout()">Logout</a>
            </div>
        </nav>
    </header>

    <main class="dashboard">
        <div id="tripInfo">
            <!-- Trip details will be loaded here -->
        </div>
        
        <div class="tabs">
            <button onclick="showTab('expenses')">Expenses</button>
            <button onclick="showTab('addExpense')">Add Expense</button>
        </div>
        
        <div id="expensesTab" class="tab-content">
            <h3>Expenses</h3>
            <div id="expensesList"></div>
        </div>
        
        <div id="addExpenseTab" class="tab-content" style="display: none;">
            <div class="form-container">
                <h3>Add Expense</h3>
                <form id="expenseForm">
                    <div class="form-group">
                        <label>Category</label>
                        <select id="category" required>
                            <option value="food">Food</option>
                            <option value="accommodation">Accommodation</option>
                            <option value="transport">Transport</option>
                            <option value="activities">Activities</option>
                            <option value="shopping">Shopping</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Amount ($)</label>
                        <input type="number" id="amount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" id="description" required>
                    </div>
                    <button type="submit" class="btn">Add Expense</button>
                </form>
            </div>
        </div>
    </main>

    <script src="../script.js"></script>
    <script>
        checkAuth();
        
        let currentTripId = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            currentTripId = parseInt(urlParams.get('id'));
            
            if (currentTripId) {
                loadTripDetails();
                loadExpenses();
            }
        });
        
        function loadTripDetails() {
            const trip = tripManager.getTrip(currentTripId);
            if (trip) {
                const totalSpent = trip.expenses.reduce((sum, exp) => sum + parseFloat(exp.amount), 0);
                const remaining = trip.budget - totalSpent;
                
                document.getElementById('tripInfo').innerHTML = `
                    <h1>${trip.destination}</h1>
                    <p>${trip.startDate} to ${trip.endDate}</p>
                    <p>Budget: ${formatCurrency(trip.budget)}</p>
                    <p>Spent: ${formatCurrency(totalSpent)}</p>
                    <p>Remaining: ${formatCurrency(remaining)}</p>
                    <p>${trip.notes}</p>
                `;
            }
        }
        
        function loadExpenses() {
            const trip = tripManager.getTrip(currentTripId);
            const expensesList = document.getElementById('expensesList');
            expensesList.innerHTML = '';
            
            if (trip && trip.expenses.length > 0) {
                trip.expenses.forEach(expense => {
                    const expenseDiv = document.createElement('div');
                    expenseDiv.className = 'trip-card';
                    expenseDiv.innerHTML = `
                        <p><strong>${expense.category}</strong>: ${formatCurrency(expense.amount)}</p>
                        <p>${expense.description}</p>
                        <button onclick="deleteExpense(${expense.id})" class="btn" style="background: #e74c3c;">Delete</button>
                    `;
                    expensesList.appendChild(expenseDiv);
                });
            } else {
                expensesList.innerHTML = '<p>No expenses yet.</p>';
            }
        }
        
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            if (tabName === 'expenses') {
                document.getElementById('expensesTab').style.display = 'block';
            } else if (tabName === 'addExpense') {
                document.getElementById('addExpenseTab').style.display = 'block';
            }
        }
        
        document.getElementById('expenseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const expense = {
                category: document.getElementById('category').value,
                amount: parseFloat(document.getElementById('amount').value),
                description: document.getElementById('description').value
            };
            
            tripManager.addExpense(currentTripId, expense);
            alert('Expense added!');
            
            // Reset form and show expenses tab
            this.reset();
            showTab('expenses');
            loadTripDetails();
            loadExpenses();
        });
        
        function deleteExpense(expenseId) {
            if (confirm('Delete this expense?')) {
                const trip = tripManager.getTrip(currentTripId);
                if (trip) {
                    trip.expenses = trip.expenses.filter(exp => exp.id !== expenseId);
                    localStorage.setItem('trips', JSON.stringify(tripManager.getTrips()));
                    loadTripDetails();
                    loadExpenses();
                }
            }
        }
    </script>
</body>
</html>